From rgarciasuarez@free.fr  Wed Dec 12 02:10:32 2001
Return-Path: <rgarciasuarez@free.fr>
Received: from onion.perl.org (onion.valueclick.com [209.85.157.220])
	by ttul.org (8.9.3/8.8.7) with SMTP id CAA20902
	for <ingy@ttul.org>; Wed, 12 Dec 2001 02:10:32 -0800
Received: (qmail 89468 invoked by uid 1008); 12 Dec 2001 10:10:31 -0000
Delivered-To: cpanmail-INGY@cpan.org
Received: (qmail 89444 invoked by uid 76); 12 Dec 2001 10:10:31 -0000
Received: from [213.41.77.52] (HELO wah.kazibao.net) (213.41.77.52)
  by onion.perl.org (qpsmtpd/0.05) with SMTP; Wed Dec 12 10:10:31 2001 -0000
Received: (qmail 12985 invoked from network); 12 Dec 2001 10:10:25 -0000
Received: from unknown (HELO rafael.kazibao.net) (193.251.9.112)
  by hosting-52.77.rev.fr.colt.net with SMTP; 12 Dec 2001 10:10:25 -0000
Received: from rafael.kazibao.net (localhost.localdomain [127.0.0.1])
	by rafael.kazibao.net (8.9.3/8.9.3) with ESMTP id LAA21301;
	Wed, 12 Dec 2001 11:11:40 +0100
Date: Wed, 12 Dec 2001 11:11:39 +0100
From: Rafael Garcia-Suarez <rgarciasuarez@free.fr>
To: INGY@cpan.org
Cc: inline@perl.org
Subject: [PATCH] Inline 0.43 and -Dversiononly problem
Message-ID: <20011212111139.A21289@rafael>
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit
X-Mailer: Balsa 1.2.3
Status: RO
X-Status: A
Content-Length: 1306
Lines: 34

Hi, I located a problem : the Inline module won't work with a Perl
configured with the -Dversiononly Configure symbol.

That's because it uses $Config{perlpath}, which has a buggy value :
it points to /your/path/to/perl instead of /your/path/to/perl5.6.1
(with -Dversiononly, all the programs installed have a trailing version
number).

The problem with $Config{perlpath} will be fixed in perl 5.8.0, but
for older perls, I suggest to fall back to $^X.

The following patch implements this.


--- Inline-0.43/C/C.pm.orig	Sun Jul 22 17:09:35 2001
+++ Inline-0.43/C/C.pm	Wed Dec 12 11:01:46 2001
@@ -656,6 +656,7 @@
       @{$o->{API}}{qw(module modpname modfname build_dir install_lib)};
 
     -f ($perl = $Config::Config{perlpath})
+      or -f ($perl = $^X)
       or croak "Can't locate your perl binary";
     $make = $o->{ILSM}{MAKE} || $Config::Config{make}
       or croak "Can't locate your make binary";
--- Inline-0.43/Inline.pm.orig	Sun Jul 22 10:00:24 2001
+++ Inline-0.43/Inline.pm	Wed Dec 12 11:02:38 2001
@@ -660,6 +660,7 @@
     if (defined $o) {
 	($dir) = $dir =~ /(.*)/s if UNTAINT;
 	my $perl = $Config{perlpath};
+	$perl = $^X unless -f $perl;
 	($perl) = $perl =~ /(.*)/s if UNTAINT;
 	local $ENV{PERL5LIB} if defined $ENV{PERL5LIB};
 	local $ENV{PERL5OPT} if defined $ENV{PERL5OPT};

